name: Changelog

on:
  workflow_run:
    workflows: ["Create release"]    # The exact name of your release workflow
    types:
      - completed

jobs:
  changelog:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Generate release changelog
        uses: janheinrichmerker/action-github-changelog-generator@v2.3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Save changelog to file
        # run: echo "${{ steps.changelog.outputs.changelog }}" > CHANGELOG.md
        run: |
          printf '%s\n' "${{ steps.changelog.outputs.changelog }}" > CHANGELOG.md
          chmod 644 CHANGELOG.md
      
      - name: Commit and push changelog
        uses: EndBug/add-and-commit@v7
        with:
          author_name: github-actions
          author_email: github-actions@github.com
          message: "chore: update CHANGELOG.md"
          add: 'CHANGELOG.md'
          push: true